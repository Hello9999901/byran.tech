<!DOCTYPE html>
<html lang="en-US">

<head>
    <!-- TITLE -->
    <title>Keyboard Human Interface Devices (HID) Usage for USB with a Raspberry Pi Zero | byran.tech</title>

    <!-- STYLESHEET -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/theming.css">
    <link rel="stylesheet" href="../css/menu.css">
    <link rel="stylesheet" href="../css/fonts.css">

    <link rel="stylesheet" href="../css/prism.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


    <!-- JAVASCRIPT -->


    <!-- VIEWPORT OPTIMIZING -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="utf-8">


    <!-- META SEO DESCRIPTIONS -->
    <meta name="title" content="Keyboard Human Interface Devices (HID) Usage for USB with a Raspberry Pi Zero">
    <meta name="author" content="Byran H (Hello9999901)">


    <!-- SAFARI TOPBAR THEME COLOR -->
    <meta name="theme-color" content="#131313">


    <!-- ANCHOR: https://ogp.me (Open Graph Headers) -->
    <meta property="og:title" content="Keyboard Human Interface Devices (HID) Usage for USB with a Raspberry Pi Zero" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.byran.tech/html/keyboard-human-interface-devices-(hid)-usage-for-usb-with-a-raspberry-pi-zero" />
    <meta property="og:image" content="https://cdn.pixabay.com/photo/2020/07/03/04/48/mechanical-keyboard-5365168_1280.jpg" />



</head>

<body onload="onloadFunction()">
    <div id="wrapper">
        <div id="topbarWrapper">
            <div id="topbarFlexWrapper">
                <a id="logoWrapper" href="../index.html">
                    <img src="../svgs/logo.svg" id="logo">
                </a>
                <div id="navWrapper">
                    <a class="navLinks" href="../art.html">3D Art</a>
                    <a class="navLinks" href="../coding.html">Coding</a>
                    <a class="navLinks" href="../tech.html">Tech</a>
                    <a class="navLinks" href="../about.html">About</a>
                </div>
            </div>
        </div>
        <nav role="navigation">
            <div id="menuToggle">
                <input type="checkbox" />

                <svg class="ham" viewBox="0 0 100 100" width="80">
                    <path class="line top"
                        d="m 30,33 h 40 c 13.100415,0 14.380204,31.80258 6.899646,33.421777 -24.612039,5.327373 9.016154,-52.337577 -12.75751,-30.563913 l -28.284272,28.284272" />
                    <path class="line middle"
                        d="m 70,50 c 0,0 -32.213436,0 -40,0 -7.786564,0 -6.428571,-4.640244 -6.428571,-8.571429 0,-5.895471 6.073743,-11.783399 12.286435,-5.570707 6.212692,6.212692 28.284272,28.284272 28.284272,28.284272" />
                    <path class="line bottom"
                        d="m 69.575405,67.073826 h -40 c -13.100415,0 -14.380204,-31.80258 -6.899646,-33.421777 24.612039,-5.327373 -9.016154,52.337577 12.75751,30.563913 l 28.284272,-28.284272" />
                </svg>

                <ul id="menu">
                    <a href="../art.html">
                        <li>3D Art</li>
                    </a>
                    <a href="../coding.html">
                        <li>Coding</li>
                    </a>
                    <a href="../tech.html">
                        <li>Tech</li>
                    </a>
                    <a href="../about.html">
                        <li>About</li>
                    </a>
                </ul>
            </div>
        </nav>
        <div class="cookieBanner" id="cookieBanner">
            <span>
                Hi! Do you allow <b>analytical cookies</b>? <b>Ad cookies are ALWAYS off</b>, as I serve no ads and
                respect your
                privacy. I use <b>Google Analytics</b> with minimal analytical cookies to learn more about the website
                so I
                can <i><b>refine byran.tech</b></i>! You can also read the <a
                    href="https://www.byran.tech/html/cookie-policy">cookie policy</a>.
                <span
                    style="display: flex; align-items: center; justify-content: center; padding-top: 10px; font-size: 1.2em;">
                    <button onclick="acceptCookies()"><b>|YES|</b></button>
                    >‚Äî‚Äî‚Äî‚Äîüç™‚Äî‚Äî‚Äî‚Äî< <button onclick="deniedCookies()"><b>|NO|</b></button>
                </span>
            </span>
        </div>
        <div id="bodyWrapper">
            <div id="articleWrapper">
                <div class="themeToggle material-icons" id="themeToggle" onclick="toggleTheme()"></div>
                <header>
                    <span class="title">Keyboard Human Interface Devices (HID) Usage for USB with a Raspberry Pi Zero</span>
                    <hr>
                    <div class="dateWrapper">
                        <div class="material-icons" id="calendar">date_range</div>
                        <span id="date">March 2021, Updated July 2021</span>
                    </div>
                </header>

                <!-- TODO: Make a list of all the articles on the side with drop-downs separated by type of article -->
                <!-- <div id="list">
                </div> -->

                <div id="body">
                    <p><b>byran.tech‚Äôs ‚ÄúPractical Treatises‚Äù #1 -</b></p>

                    <p><b>Keyboard Human Interface Devices (HID) Usage for USB with a Raspberry Pi Zero</b></p>

                    <p>
                        Few people truly know how their very own keyboard transmits data to their computer. Even fewer
                        know
                        how to utilize it to its full potential. This PT (practical treatise) will teach one about the
                        nuts
                        and bolts of the HID standard, using a Raspberry Pi Zero with a driver alteration to make it
                        into a
                        HID (more specifically a keyboard HID), thereby turning it into a standard USB keyboard.
                    </p>

                    <b>Prerequisites:</b>
                    <p>
                        <br>
                        - Intermediate Python Knowledge
                        <br>
                        - Intermediate BASH Knowledge
                        <br>
                        - Some patience and curiosity
                        <br>
                        - Raspberry Pi Zero (optional)
                        <br>
                    </p>
                    <br>
                    <p><b>DISCLAIMER:</b></p>

                    <p>
                        <b>
                            This concept can be utilized as a key injection tool or more. All the information being
                            presented
                            on this page is for EDUCATIONAL, ETHICAL, and MORAL purposes ONLY.
                        </b>
                    </p>

                    <p>
                        There are two types of HID key IDs. One is dec (decimal) and another is hex (hex code). The
                        basis
                        behind each is simple: Dec has integers to identify each key, while Hex utilizes hex code to
                        identify each key. It is a blessing that HID is basically universal in USB.
                    </p>

                    <p>
                        Using MightyPork‚Äôs USB HID Keyboard scan codes, this page will tell you everything you need to
                        know
                        to utilize HID ID codes to the fullest, with lots of sample scripts to test and learn from.
                    </p>

                    <p>
                        There is a surprising lack of information for HID scan codes on the internet, especially for
                        Raspberry Pi Zero. There are multiple tutorials for different parts, but there is no large,
                        complete
                        treatise for such. This page (tutorial does not seem like a fitting word, as this does not serve
                        for
                        the purposes of teaching a single task; rather, it hopes to serve as reference. I‚Äôll be
                        referring to
                        it as ‚Äúpage‚Äù, then) hopes to do exact that.
                    </p>

                    <p>
                        To set up the Raspberry Pi Zero, iSticktoit has made this great page explaining how and the
                        necessary commands. Since this page focuses on HID, which stands for Human Interface Devices. I
                        will
                        not be going into detail about how each command works.
                    </p>


                    <p>Here is the link to iSticktoit‚Äôs page:</p>
                    <p><a href="http://www.isticktoit.net/?p=1383">Click Here</a></p>


                    <p>Here is the Random Nerd Tutorials tutorial that has been used for reference:</p>
                    <p><a href="https://randomnerdtutorials.com/raspberry-pi-zero-usb-keyboard-hid/">Click Here</a></p>

                    <p>Here are the commands:</p>

                    <pre>
<code class="language-bash">
echo ‚Äúdtoverlay=dwc2‚Äù | sudo tee -a /boot/config.txt
echo ‚Äúdwc2‚Äù | sudo tee -a /etc/modules
echo ‚Äúlibcomposite‚Äù | sudo tee -a /etc/modules
</code>
</pre>
                    <br>
                    <p>
                        It is important to note that these commands only work on certain Raspberry Pis. It is well
                        documented and tested that the above commands function and serve their purpose on Raspberry Pi
                        Zero
                        (W or no W).
                    </p>

                    <p>
                        Random Nerd Tutorials‚Äôs tutorial is infinitely useful. However, it is lacking in detailed
                        explanations of how HID works, limiting how far a user can develop and utilize such a helpful
                        tool.
                    </p>

                    <p>Here is a GitHub Gist on USB HID Keyboard scan codes:</p>

                    <p><a href="https://gist.github.com/MightyPork/6da26e382a7ad91b5496ee55fdc73db2">Click Here</a></p>

                    <p>^^ ** INCREDIBLY IMPORTANT ** ^^</p>

                    <p>Here is the official HID for USB PDF (it is old, but includes dec for Python and hex)</p>

                    <p><a href="https://www.usb.org/sites/default/files/documents/hut1_12v2.pdf">Click Here</a></p>

                    <p>^^ ** INCREDIBLY IMPORTANT ** ^^</p>

                    <p>More reference links:</p>

                    <p><a href="https://www.rmedgar.com/blog/using-rpi-zero-as-keyboard-send-reports/">Click Here</a></p>

                    <p><a href="https://www.rmedgar.com/blog/using-rpi-zero-as-keyboard-report-descriptor/">Click Here</a></p>

                    <p>
                        <b>
                            Now, once a Raspberry Pi Zero is SETUP WITH RANDOM NERD TUTORIALS‚Äôs TUTORIAL (optional if
                            you just
                            want to learn HID codes) and have perused (or skimmed) through the GitHub Gist, it is time
                            to get
                            into the nuts and bolts of how USB HID, specifically regarding keyboards, work.
                        </b>
                    </p>

                    <p>
                        It is interesting how the information is scattered throughout the internet like a scavenger
                        hunt,
                        and one‚Äôs goal is to gather all the different parts of each site and piece it into one cohesive
                        final product.
                    </p>

                    <p>There are two ways to make programs with the above information: Python and BASH (Bourne-Again
                        Shell)</p>

                    <p>Please read both to gain a full understanding.</p>

                    <p>
                        <pre><code class="language-bash">Bourne-Again Shell Way
First sample program:
‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
1| #!/bin/bash # shebang
2| function write_report { # function to encode for HID
3| echo -ne $1 > /dev/hidg0 # writes to /dev/hidg0 (HID stuff)
4| } # end of function
5| # Writes the key ‚ÄúB‚Äù,
6| # which is shift + ‚Äúb‚Äù
7| write_report "\x20\0\x5\0\0\0\0\0"
</code>
</pre>
                    </p>

                    <p>
                        The first 6 lines are relatively easy to comprehend; however, the last line seems a bit scary,
                        right? Here is what it does: it utilizes the write_report function, which as mentioned earlier
                        writes to /dev/hidg0, and then sends this: "\x20\0\x5\0\0\0\0\0".
                    </p>

                    <p>Here is exactly what it does:</p>

                    <p>
                        The x20 is the hex for right shift, while the x5 is the hex ‚Äúb‚Äù. Shift + a letter is, well, the
                        capital letter. Very simple, right?
                    </p>

                    <p>
                        There are 8 sections in a HID scan code, each a byte in size. They merge together to form a
                        formal
                        keystroke to send through USB. There are places to put specific signs and modifiers:
                    </p>

                    <p>Section one is for <b>modifiers</b></p>

                    <p>Section two is for other purposes, usually unused or for OEMs</p>

                    <p>Section 3-8 is for pressed key strokes.</p>

                    <pre>
                        <code class="language-bash">
Demonstration/Visual

   1 2 3 4 5 6 7 8 bytes!
‚Äú\x20\0\x5\0\0\0\0\0‚Äù
                        </code>
                    </pre>

                    <p>
                        In more detailed terms, byte 1 is for <b>modifiers</b>, byte 2 is unused or for OEMs, and the
                        last 6
                        bytes are for keystrokes.
                    </p>

                    <p>
                        The modifier ID codes are very confusing; they do not correspond to the modifier key codes in
                        the
                        HID Scan Codes for USB PDF. MightyPork‚Äôs Gist explains exactly how to use modifier keys codes.
                    </p>

                    <pre>
<code class="language-bash">
/**
* Modifier masks - used for the first byte in the HID report.
* NOTE: The second byte in the report is reserved, 0x00
*/

KEY_MOD_LCTRL 0x01

KEY_MOD_LSHIFT 0x02

KEY_MOD_LALT 0x04

KEY_MOD_LMETA 0x08

KEY_MOD_RCTRL 0x10

KEY_MOD_RSHIFT 0x20

KEY_MOD_RALT 0x40

KEY_MOD_RMETA 0x80
</code>
</pre>

                    <p>
                        As you can see, these are modifier **masks**, not actual modifier keys. So, for example, if you
                        want
                        to press **control c**, it would be:
                    </p>

                    <pre><code class="language-bash">\x1\0\x6\0\0\0\0\0</code></pre>

                    <p>The x1 means the left control, while x6 means c. Simple!</p>

                    <p>
                        A <b>modifier mask</b> will ALWAYS be on the first byte, while a key press will be on the 3rd
                        byte.
                        There is ALWAYS an x in front of a key‚Äôs hex code. Lastly, if the hex code starts with zero,
                        (i.e.
                        KEY_MOD_LCTRL is 0x01, it would translate to \x1\)
                    </p>

                    <p>
                        To lift all keys, (if you don‚Äôt, the key will infinity be held down until you lift it through
                        the
                        script or unplug the RPI Zero), put this in the code:
                    </p>

                    <pre><code class="language-bash">\0\0\0\0\0\0\0\0</code></pre>

                    <p>
                        With this, you have all the skills you need to type just about anything in Windows, macOS, or
                        Linux (or
                        anything that supports keyboard HID).
                    </p>

                    <b>Python Way</b>

                    <p>In Python, it utilizes the same concept as BASH, but the code is completely different.</p>

                    <p>Here are a few things that will hopefully explain the code a little better:</p>

                    <p>NULL_CHAR is the same as ‚Äú\0\‚Äù in BASH</p>

                    <p>
                        The function write_report is what encodes the program for use on the RPi Zero, which is the same
                        in
                        BASH, just utilizes and phrased a little different.
                    </p>

                    <p>
                        Lastly, it utilizes the write_report function to generate the keystrokes. For example, typing
                        ‚ÄúA‚Äù
                        (uppercase/capitalized ‚Äúa‚Äù) is
                    </p>

                    <p>
                        <b>
                            Note that this is written in DECIMAL instead of HEX. You'll need to translate it. Just
                            google it. It's very simple and I probably can't explain it properly anyways.
                        </b>
                    </p>

                    <pre><code class="language-python">write_report(NULL_CHAR*2+chr(4)+NULL_CHAR*5)</code></pre>

                    <br>
                    <p><b>Sample Program:</b></p>

<pre>
<code class="language-python">
#!/usr/bin/env python3
NULL_CHAR = chr(0)
def write_report(report):
with open('/dev/hidg0', 'rb+') as fd:
fd.write(report.encode())
# KEY_A = "a"
write_report(NULL_CHAR*2+chr(4)+NULL_CHAR*5)
# KEY_MOD_RSHIFT + KEY_A = "A"
write_report(chr(32)+NULL_CHAR+chr(4)+NULL_CHAR*5)
# etc.
# KEY_MOD_LCTRL + KEY_B = Ctrl + b
write_report(chr(1)+NULL_CHAR+chr(5)+NULL_CHAR*5)
# etc.
# Lift all the keys (same as \0\0\0\0\0\0\0\0 in BASH)
# You should do this at the end of each program, or else the computer will think the keys were held
down forever.
write_report(NULL_CHAR*8)
</code>
</pre>
                </div>
            </div>
            <footer>
                <span>üßë‚Äçüíª Created by <b>Byran H</b>. üìÉ Copyleft under the <b>MIT License</b>. üì≤ For more
                    information,
                    check
                    out the <a href="https://www.byran.tech/about.html" target="_blank"><b>about page</b></a>.
                    &lt;/&gt; Otherwise, check out <a href="https://github.com/Hello9999901/byran.tech"
                        target="_blank"><b>my
                            source
                            code on GitHub!</b></a></span>
            </footer>
        </div>
        <!-- JAVASCRIPT -->

        <script src="../js/prism.js"></script>
        <script src="../js/scripts.js"></script>
</body>

</html>